<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PH Weather Widget (Small Font)</title>
<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#f2f4f8;
    display:flex;
    justify-content:center;
    padding:15px;
}
.card {
    width:100%;
    max-width:360px;
    background: linear-gradient(145deg,#ffffff,#e6f0ff);
    border-radius:18px;
    padding:15px;
    box-shadow:0 6px 18px rgba(0,0,0,0.2);
    text-align:center;
    position:relative;
    overflow:hidden;
}

/* FONT SIZE ADJUSTMENTS */
.location { 
    font-size:14px; 
    font-weight:700; 
    margin-bottom:6px; 
    color:#1a237e; 
}
.temp { 
    font-size:32px; 
    font-weight:bold; 
    margin:4px 0; 
    color:#ff5722; 
}
.condition { 
    font-size:13px; 
    color:#1976d2; 
}
.forecast { 
    display:flex; 
    justify-content:space-around; 
    margin-top:12px; 
}
.day { text-align:center; font-size:11px; }
.day .icon { font-size:20px; }
.day .temp { color:#ff5722; font-size:11px; font-weight:600; margin-top:3px; }

/* MINI WEATHER ANIMATIONS */
.sun {
    position:absolute; top:18px; left:50%;
    transform:translateX(-50%);
    width:55px; height:55px;
    background:yellow; border-radius:50%;
    animation:sunMove 10s linear infinite;
    opacity:0.8;
}
@keyframes sunMove {
    0%{top:18px;} 50%{top:10px;} 100%{top:18px;}
}

.cloud {
    position:absolute;
    top:25px;
    width:90px; height:40px;
    background:#fff; border-radius:50px;
    opacity:0.8;
    animation:cloudMove 60s linear infinite;
}
.cloud::before, .cloud::after {
    content:"";
    position:absolute;
    background:#fff;
    width:40px; height:40px;
    border-radius:50%;
}
.cloud::before { top:-20px; left:8px; }
.cloud::after { top:-10px; left:30px; }
@keyframes cloudMove {
    0%{left:-120px;} 100%{left:380px;}
}

.rain { position:absolute; top:0; width:100%; height:100%; pointer-events:none; }
.drop {
    position:absolute;
    width:2px; height:8px;
    background:#00f;
    animation:rainFall 1s linear infinite;
}
@keyframes rainFall {
    0%{top:-10px;} 100%{top:250px;}
}

.snow { position:absolute; top:0; width:100%; height:100%; pointer-events:none; }
.sflake {
    position:absolute;
    width:4px; height:4px;
    background:white; border-radius:50%;
    animation:snowFall 5s linear infinite;
}
@keyframes snowFall {
    0%{top:-5px;} 100%{top:260px;}
}

@media (prefers-color-scheme: dark) {
    body { background:#1a1a1a; }
    .card { background:#2a2a2a; color:#f2f2f2; }
    .location { color:#ffffff; }
    .temp { color:#ffc107; }
    .condition { color:#90caf9; }
    .day .temp { color:#ffc107; }
}
</style>
</head>
<body>

<div class="card" id="weather-card">
    <div id="location" class="location">Detecting location...</div>
    <div id="temp" class="temp">--¬∞C</div>
    <div id="condition" class="condition">Loading...</div>
    <div class="forecast" id="forecast"></div>
</div>

<script>
const weatherIcons = {
    0:'‚òÄÔ∏è',1:'üå§Ô∏è',2:'‚õÖ',3:'‚òÅÔ∏è',
    45:'üå´Ô∏è',48:'üå´Ô∏è',51:'üå¶Ô∏è',53:'üå¶Ô∏è',
    55:'üåßÔ∏è',56:'üå®Ô∏è',57:'üå®Ô∏è',61:'üåßÔ∏è',
    63:'üåßÔ∏è',65:'üåßÔ∏è',66:'‚ùÑÔ∏è',67:'‚ùÑÔ∏è',
    71:'‚ùÑÔ∏è',73:'‚ùÑÔ∏è',75:'‚ùÑÔ∏è',77:'‚ùÑÔ∏è',
    80:'üåßÔ∏è',81:'üåßÔ∏è',82:'üåßÔ∏è',95:'‚õàÔ∏è',
    96:'‚õàÔ∏è',99:'‚õàÔ∏è'
};

function showError(msg){
    document.getElementById("location").textContent="Location unavailable";
    document.getElementById("temp").textContent="--¬∞C";
    document.getElementById("condition").textContent=msg||"Unable to load weather";
}

function clearWeatherEffects(){
    document.querySelectorAll('.sun,.cloud,.rain,.drop,.snow,.sflake')
        .forEach(e=>e.remove());
}

function addWeatherEffect(code){
    const card=document.getElementById("weather-card");
    clearWeatherEffects();

    if(code===0){
        const sun=document.createElement("div");
        sun.className="sun";
        card.appendChild(sun);
    }
    else if([1,2,3].includes(code)){
        const cloud=document.createElement("div");
        cloud.className="cloud";
        cloud.style.top="25px";
        card.appendChild(cloud);
    }
    else if([51,53,55,61,63,65,80,81,82].includes(code)){
        const cloud=document.createElement("div");
        cloud.className="cloud";
        card.appendChild(cloud);
        for(let i=0;i<20;i++){
            const drop=document.createElement("div");
            drop.className="drop";
            drop.style.left=Math.random()*100+"%";
            drop.style.animationDuration=(0.5+Math.random()*1.5)+"s";
            card.appendChild(drop);
        }
    }
    else{
        const cloud=document.createElement("div");
        cloud.className="cloud";
        card.appendChild(cloud);
        for(let i=0;i<15;i++){
            const sf=document.createElement("div");
            sf.className="sflake";
            sf.style.left=Math.random()*100+"%";
            sf.style.animationDuration=(3+Math.random()*3)+"s";
            card.appendChild(sf);
        }
    }
}

function fetchWeather(lat,lon,cityName){
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`)
    .then(r=>r.json())
    .then(data=>{
        if(!data.current_weather){ showError("Weather unavailable"); return; }

        const code=data.current_weather.weathercode;

        document.getElementById("location").textContent=cityName||"Your Location";
        document.getElementById("temp").textContent=data.current_weather.temperature+"¬∞C";
        document.getElementById("condition").textContent=weatherIcons[code]||"üå§Ô∏è";

        addWeatherEffect(code);

        const forecastDiv=document.getElementById("forecast");
        forecastDiv.innerHTML="";

        for(let i=0;i<3;i++){
            const dayName=new Date(data.daily.time[i]).toLocaleDateString("en-US",{weekday:"short"});
            const icon=weatherIcons[data.daily.weathercode[i]]||"üå§Ô∏è";
            const max=Math.round(data.daily.temperature_2m_max[i]);
            const min=Math.round(data.daily.temperature_2m_min[i]);

            forecastDiv.innerHTML += `
                <div class="day">
                    <div>${dayName}</div>
                    <div class="icon">${icon}</div>
                    <div class="temp">${max}¬∞ / ${min}¬∞</div>
                </div>
            `;
        }
    })
    .catch(()=>showError("Weather API error"));
}

function detectLocation(){
    if("geolocation" in navigator){
        navigator.geolocation.getCurrentPosition(
            pos=>fetchWeather(pos.coords.latitude,pos.coords.longitude,"Your Location"),
            ()=>fetchIPLocation()
        );
    } else fetchIPLocation();
}

function fetchIPLocation(){
    fetch("https://geolocation-db.com/json/")
    .then(r=>r.json())
    .then(loc=>{
        fetchWeather(loc.latitude,loc.longitude,loc.city||"Your Location");
    })
    .catch(()=>showError("Location unavailable"));
}

detectLocation();
</script>

</body>
</html>
