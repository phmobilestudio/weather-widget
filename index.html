<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weather Widget</title>

<style>
  body {
    margin: 0;
    padding: 0;
    background: transparent !important;
    font-family: Arial, sans-serif;
  }

  .weather-widget {
    width: 100%;
    max-width: 280px;
    margin: auto;
    text-align: center;
    color: #222;
    font-size: 11px; /* Smaller text */
  }

  .current-temp {
    font-size: 20px;
    font-weight: bold;
  }

  .icon-large {
    font-size: 26px;
    margin: 5px 0;
  }

  .forecast {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
  }

  .day {
    flex: 1;
  }

  .day div {
    margin-bottom: 3px;
  }
</style>
</head>

<body>

<div class="weather-widget">
  <div id="place">Your Location</div>
  <div class="current-temp" id="temp">--Â°C</div>
  <div class="icon-large" id="icon">â›…</div>

  <div class="forecast" id="forecast">
    <!-- Forecast populated by JS -->
  </div>
</div>

<script>
(async () => {
  try {
    // ğŸ”µ Step 1: Detect location using free IP Geolocation
    const geo = await fetch("https://ipapi.co/json/").then(r => r.json());

    const lat = geo.latitude;
    const lon = geo.longitude;

    if (!lat || !lon) throw new Error("Location unavailable");

    document.getElementById("place").textContent = geo.city || "Your Location";

    // ğŸ”µ Step 2: Fetch weather using Open-Meteo
    const weatherURL =
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
      `&current=temperature_2m,weather_code` +
      `&daily=weather_code,temperature_2m_max,temperature_2m_min` +
      `&timezone=auto`;

    const data = await fetch(weatherURL).then(r => r.json());

    // ğŸŒ¡ Current temp
    document.getElementById("temp").textContent =
      data.current.temperature_2m + "Â°C";

    // ğŸŒ¤ Weather icon from code
    const wmo = data.current.weather_code;
    const icons = {
      0: "â˜€ï¸", 1: "ğŸŒ¤ï¸", 2: "â›…", 3: "â˜ï¸",
      45: "ğŸŒ«ï¸", 48: "ğŸŒ«ï¸",
      51: "ğŸŒ¦ï¸", 61: "ğŸŒ§ï¸", 71: "â„ï¸",
      95: "â›ˆï¸"
    };

    document.getElementById("icon").textContent = icons[wmo] || "â›…";

    // ğŸ“… Forecast
    let out = "";
    for (let i = 1; i <= 3; i++) {
      out += `
        <div class="day">
          <div><strong>${new Date(data.daily.time[i]).toLocaleDateString("en-US", { weekday: "short" })}</strong></div>
          <div>${icons[data.daily.weather_code[i]] || "â›…"}</div>
          <div>${data.daily.temperature_2m_max[i]}Â° / ${data.daily.temperature_2m_min[i]}Â°</div>
        </div>`;
    }
    document.getElementById("forecast").innerHTML = out;

  } catch (err) {
    document.getElementById("place").textContent = "Location unavailable";
    document.getElementById("temp").textContent = "--Â°C";
    document.getElementById("icon").textContent = "âš ï¸";
  }
})();
</script>

</body>
</html>
